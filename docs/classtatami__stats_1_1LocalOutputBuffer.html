<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tatami_stats: tatami_stats::LocalOutputBuffer&lt; Output_ &gt; Class Template Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">tatami_stats
   </div>
   <div id="projectbrief">Matrix statistics for tatami</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacetatami__stats.html">tatami_stats</a></li><li class="navelem"><a class="el" href="classtatami__stats_1_1LocalOutputBuffer.html">LocalOutputBuffer</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classtatami__stats_1_1LocalOutputBuffer-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">tatami_stats::LocalOutputBuffer&lt; Output_ &gt; Class Template Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Local output buffer for running calculations.  
 <a href="#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="utils_8hpp_source.html">utils.hpp</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a25a3f87da56ab90796f207b37508f8e7" id="r_a25a3f87da56ab90796f207b37508f8e7"><td class="memTemplParams" colspan="2">template&lt;typename Index_ &gt; </td></tr>
<tr class="memitem:a25a3f87da56ab90796f207b37508f8e7"><td class="memTemplItemLeft" align="right" valign="top">&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="#a25a3f87da56ab90796f207b37508f8e7">LocalOutputBuffer</a> (size_t thread, Index_ start, Index_ length, Output_ *output, Output_ fill)</td></tr>
<tr class="separator:a25a3f87da56ab90796f207b37508f8e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1f9f07457ec2d43b0b6debd2657814d" id="r_af1f9f07457ec2d43b0b6debd2657814d"><td class="memTemplParams" colspan="2">template&lt;typename Index_ &gt; </td></tr>
<tr class="memitem:af1f9f07457ec2d43b0b6debd2657814d"><td class="memTemplItemLeft" align="right" valign="top">&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="#af1f9f07457ec2d43b0b6debd2657814d">LocalOutputBuffer</a> (size_t thread, Index_ start, Index_ length, Output_ *output)</td></tr>
<tr class="separator:af1f9f07457ec2d43b0b6debd2657814d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acaa202c720dd81dd06f73e0bc3702b28" id="r_acaa202c720dd81dd06f73e0bc3702b28"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#acaa202c720dd81dd06f73e0bc3702b28">LocalOutputBuffer</a> ()=default</td></tr>
<tr class="separator:acaa202c720dd81dd06f73e0bc3702b28"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6945cd032378e8cd76a10e6ee0a437da" id="r_a6945cd032378e8cd76a10e6ee0a437da"><td class="memItemLeft" align="right" valign="top">Output_ *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6945cd032378e8cd76a10e6ee0a437da">data</a> ()</td></tr>
<tr class="separator:a6945cd032378e8cd76a10e6ee0a437da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae53e9000251661be083d992e9f1cb8be" id="r_ae53e9000251661be083d992e9f1cb8be"><td class="memItemLeft" align="right" valign="top">const Output_ *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae53e9000251661be083d992e9f1cb8be">data</a> () const</td></tr>
<tr class="separator:ae53e9000251661be083d992e9f1cb8be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a64ee29c3a09b95a5d44c5111f357720e" id="r_a64ee29c3a09b95a5d44c5111f357720e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a64ee29c3a09b95a5d44c5111f357720e">transfer</a> ()</td></tr>
<tr class="separator:a64ee29c3a09b95a5d44c5111f357720e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><div class="compoundTemplParams">template&lt;typename Output_&gt;<br />
class tatami_stats::LocalOutputBuffer&lt; Output_ &gt;</div><p>Local output buffer for running calculations. </p>
<p>A common parallelization scheme involves dividing the set of objective vectors into contiguous blocks, where each thread operates on a block at a time. However, in running calculations, an entire block's statistics are updated when its corresponding thread processes an observed vector. If these statistics are stored in a global output buffer, false sharing at the boundaries of the blocks can degrade performance.</p>
<p>To mitigate false sharing, we create a separate <code>std::vector</code> in each thread to store its output statistics. The aim is to give the memory allocator an opportunity to store each thread's vector contents at non-contiguous addresses on the heap. (While not guaranteed, well-separated addresses are observed on many compiler/architecture combinations, presumably due to the use of multiple arenas - see <a href="https://github.com/tatami-inc/tatami_stats/issues/9">https://github.com/tatami-inc/tatami_stats/issues/9</a> for testing.) Once the calculations are finished, each thread can transfer its statistics to the global buffer.</p>
<p>The <code><a class="el" href="classtatami__stats_1_1LocalOutputBuffer.html" title="Local output buffer for running calculations.">LocalOutputBuffer</a></code> is just a wrapper around a <code>std::vector</code> with some special behavior for the first thread. Specifically, the first thread is allowed to directly write to the global buffer. This avoids any extra allocation in the serial case where there is no need to protect against false sharing.</p>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">Output_</td><td>Type of the result. </td></tr>
  </table>
  </dd>
</dl>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a25a3f87da56ab90796f207b37508f8e7" name="a25a3f87da56ab90796f207b37508f8e7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a25a3f87da56ab90796f207b37508f8e7">&#9670;&#160;</a></span>LocalOutputBuffer() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Output_ &gt; </div>
<div class="memtemplate">
template&lt;typename Index_ &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classtatami__stats_1_1LocalOutputBuffer.html">tatami_stats::LocalOutputBuffer</a>&lt; Output_ &gt;::LocalOutputBuffer </td>
          <td>(</td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>thread</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Index_</td>          <td class="paramname"><span class="paramname"><em>start</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Index_</td>          <td class="paramname"><span class="paramname"><em>length</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Output_ *</td>          <td class="paramname"><span class="paramname"><em>output</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Output_</td>          <td class="paramname"><span class="paramname"><em>fill</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">Index_</td><td>Type of the start index and length. </td></tr>
  </table>
  </dd>
</dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">thread</td><td>Identity of the thread, starting from zero to the total number of threads. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">start</td><td>Index of the first objective vector in the contiguous block for this thread. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">length</td><td>Number of objective vectors in the contiguous block for this thread. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">output</td><td>Pointer to the global output buffer. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">fill</td><td>Initial value to fill the buffer. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="af1f9f07457ec2d43b0b6debd2657814d" name="af1f9f07457ec2d43b0b6debd2657814d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af1f9f07457ec2d43b0b6debd2657814d">&#9670;&#160;</a></span>LocalOutputBuffer() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Output_ &gt; </div>
<div class="memtemplate">
template&lt;typename Index_ &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classtatami__stats_1_1LocalOutputBuffer.html">tatami_stats::LocalOutputBuffer</a>&lt; Output_ &gt;::LocalOutputBuffer </td>
          <td>(</td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>thread</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Index_</td>          <td class="paramname"><span class="paramname"><em>start</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Index_</td>          <td class="paramname"><span class="paramname"><em>length</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Output_ *</td>          <td class="paramname"><span class="paramname"><em>output</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Overloaded constructor that sets the default <code>fill = 0</code>.</p>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">Index_</td><td>Type of the start index and length. </td></tr>
  </table>
  </dd>
</dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">thread</td><td>Identity of the thread, starting from zero to the total number of threads. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">start</td><td>Index of the first objective vector in the contiguous block for this thread. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">length</td><td>Number of objective vectors in the contiguous block for this thread. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">output</td><td>Pointer to the global output buffer. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="acaa202c720dd81dd06f73e0bc3702b28" name="acaa202c720dd81dd06f73e0bc3702b28"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acaa202c720dd81dd06f73e0bc3702b28">&#9670;&#160;</a></span>LocalOutputBuffer() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Output_ &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classtatami__stats_1_1LocalOutputBuffer.html">tatami_stats::LocalOutputBuffer</a>&lt; Output_ &gt;::LocalOutputBuffer </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">default</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Default constructor. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a6945cd032378e8cd76a10e6ee0a437da" name="a6945cd032378e8cd76a10e6ee0a437da"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6945cd032378e8cd76a10e6ee0a437da">&#9670;&#160;</a></span>data() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Output_ &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Output_ * <a class="el" href="classtatami__stats_1_1LocalOutputBuffer.html">tatami_stats::LocalOutputBuffer</a>&lt; Output_ &gt;::data </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="section return"><dt>Returns</dt><dd>Pointer to an output buffer to use for this thread. This contains at least <code>length</code> addressable elements (see the argument of the same name in the constructor). For <code>thread = 0</code>, this will be equal to <code>output + start</code>. </dd></dl>

</div>
</div>
<a id="ae53e9000251661be083d992e9f1cb8be" name="ae53e9000251661be083d992e9f1cb8be"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae53e9000251661be083d992e9f1cb8be">&#9670;&#160;</a></span>data() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Output_ &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const Output_ * <a class="el" href="classtatami__stats_1_1LocalOutputBuffer.html">tatami_stats::LocalOutputBuffer</a>&lt; Output_ &gt;::data </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="section return"><dt>Returns</dt><dd>Const pointer to an output buffer to use for this thread. This contains at least <code>length</code> addressable elements (see the argument of the same name in the constructor). For <code>thread = 0</code>, this will be equal to <code>output + start</code>. </dd></dl>

</div>
</div>
<a id="a64ee29c3a09b95a5d44c5111f357720e" name="a64ee29c3a09b95a5d44c5111f357720e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a64ee29c3a09b95a5d44c5111f357720e">&#9670;&#160;</a></span>transfer()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Output_ &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classtatami__stats_1_1LocalOutputBuffer.html">tatami_stats::LocalOutputBuffer</a>&lt; Output_ &gt;::transfer </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Transfer results from the local buffer to the global buffer (i.e., <code>output</code> in the constructor). For <code>thread = 0</code>, this will be a no-op. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>tatami_stats/<a class="el" href="utils_8hpp_source.html">utils.hpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
