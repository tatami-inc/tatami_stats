<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tatami_stats: Matrix statistics for tatami</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">tatami_stats
   </div>
   <div id="projectbrief">Matrix statistics for tatami</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Matrix statistics for tatami </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__2github_2workspace_2README"></a></p>
<p><img src="https://github.com/tatami-inc/tatami_stats/actions/workflows/run-tests.yaml/badge.svg" alt="Unit tests" style="pointer-events: none;" class="inline"/> <img src="https://github.com/tatami-inc/tatami_stats/actions/workflows/doxygenate.yaml/badge.svg" alt="Documentation" style="pointer-events: none;" class="inline"/> <a href="https://codecov.io/gh/tatami-inc/tatami_stats"><img src="https://codecov.io/gh/tatami-inc/tatami_stats/branch/master/graph/badge.svg?token=wt1JXHOpEk" alt="Codecov" style="pointer-events: none;" class="inline"/></a></p>
<h1>Overview</h1>
<p>This library contains helper functions to compute matrix statistics for <a href="https://github.com/tatami-inc/tatami"><b>tatami</b></a>, loosely inspired by what the <b>matrixStats</b> R package does for R matrices. It currently performs calculation of sums, variances, medians, ranges, etc. along either dimension. Each function automatically chooses the most efficient algorithm based on the matrix properties (e.g., sparsity, preferred access). Calculations can be parallelized across dimension elements via <code><a class="elRef" href="https://tatami-inc.github.io/tatami/namespacetatami.html#a5a08e0387bc00e8045a0364d6e35d120">tatami::parallelize()</a></code>. If NaNs are present, they can be treated as missing and skipped. Low-level utilities for each algorithm are also exported for developer convenience.</p>
<h1>Quick start</h1>
<p><b><a class="el" href="namespacetatami__stats.html" title="Functions to compute statistics from a tatami::Matrix.">tatami_stats</a></b> is a header-only library, so it can be easily used by just <code>#include</code>ing the relevant source files:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tatami__stats_8hpp.html">tatami_stats/tatami_stats.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line">std::shared_ptr&lt;tatami::NumericMatrix&gt; mat(</div>
<div class="line">    <span class="keyword">new</span> <a class="code hl_classRef" href="https://tatami-inc.github.io/tatami/classtatami_1_1DenseRowMatrix.html">tatami::DenseRowMatrix&lt;double, int&gt;</a>(nrows, ncols, vals)</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Compute row-wise medians.</span></div>
<div class="line"><span class="keyword">auto</span> row_medians = <a class="code hl_function" href="namespacetatami__stats_1_1medians.html#ab70115fd094f9395a13bd3d18418df51">tatami_stats::medians::by_row</a>(mat.get());</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Column-wise means and variances with NaN skipping and multiple threads.</span></div>
<div class="line"><a class="code hl_struct" href="structtatami__stats_1_1variances_1_1Options.html">tatami_stats::variances::Options</a> vopt;</div>
<div class="line">vopt.<a class="code hl_variable" href="structtatami__stats_1_1variances_1_1Options.html#aeb3ee96b5c18332bd57e0633c3593c53">skip_nan</a> = <span class="keyword">true</span>;</div>
<div class="line">vopt.<a class="code hl_variable" href="structtatami__stats_1_1variances_1_1Options.html#a067e87951e90ca4510b110c13efe56cb">num_threads</a> = 5;</div>
<div class="line"><span class="keyword">auto</span> col_mean_and_var = <a class="code hl_function" href="namespacetatami__stats_1_1variances.html#a1b78af51c1130641ff940ce5bbc8b645">tatami_stats::variances::by_column</a>(mat.get(), vopt);</div>
<div class="ttc" id="aclasstatami_1_1DenseRowMatrix_html"><div class="ttname"><a href="https://tatami-inc.github.io/tatami/classtatami_1_1DenseRowMatrix.html">tatami::DenseRowMatrix</a></div></div>
<div class="ttc" id="anamespacetatami__stats_1_1medians_html_ab70115fd094f9395a13bd3d18418df51"><div class="ttname"><a href="namespacetatami__stats_1_1medians.html#ab70115fd094f9395a13bd3d18418df51">tatami_stats::medians::by_row</a></div><div class="ttdeci">std::vector&lt; Output_ &gt; by_row(const tatami::Matrix&lt; Value_, Index_ &gt; &amp;mat, const Options &amp;mopt)</div><div class="ttdef"><b>Definition</b> medians.hpp:338</div></div>
<div class="ttc" id="anamespacetatami__stats_1_1variances_html_a1b78af51c1130641ff940ce5bbc8b645"><div class="ttname"><a href="namespacetatami__stats_1_1variances.html#a1b78af51c1130641ff940ce5bbc8b645">tatami_stats::variances::by_column</a></div><div class="ttdeci">std::vector&lt; Output_ &gt; by_column(const tatami::Matrix&lt; Value_, Index_ &gt; &amp;mat, const Options &amp;vopt)</div><div class="ttdef"><b>Definition</b> variances.hpp:493</div></div>
<div class="ttc" id="astructtatami__stats_1_1variances_1_1Options_html"><div class="ttname"><a href="structtatami__stats_1_1variances_1_1Options.html">tatami_stats::variances::Options</a></div><div class="ttdoc">Variance calculation options.</div><div class="ttdef"><b>Definition</b> variances.hpp:31</div></div>
<div class="ttc" id="astructtatami__stats_1_1variances_1_1Options_html_a067e87951e90ca4510b110c13efe56cb"><div class="ttname"><a href="structtatami__stats_1_1variances_1_1Options.html#a067e87951e90ca4510b110c13efe56cb">tatami_stats::variances::Options::num_threads</a></div><div class="ttdeci">int num_threads</div><div class="ttdef"><b>Definition</b> variances.hpp:42</div></div>
<div class="ttc" id="astructtatami__stats_1_1variances_1_1Options_html_aeb3ee96b5c18332bd57e0633c3593c53"><div class="ttname"><a href="structtatami__stats_1_1variances_1_1Options.html#aeb3ee96b5c18332bd57e0633c3593c53">tatami_stats::variances::Options::skip_nan</a></div><div class="ttdeci">bool skip_nan</div><div class="ttdef"><b>Definition</b> variances.hpp:36</div></div>
<div class="ttc" id="atatami__stats_8hpp_html"><div class="ttname"><a href="tatami__stats_8hpp.html">tatami_stats.hpp</a></div><div class="ttdoc">Umbrella header for the tatami_stats library.</div></div>
</div><!-- fragment --><p>Check out the <a href="https://tatami-inc.github.io/tatami_stats">API documentation</a> for more details.</p>
<h1>Lower-level functionality</h1>
<p>The <code>apply()</code> function in each statistic's namespace offers more control over the calculation of each statistic. For example, instead of creating a new vector, we can fill an existing array with the sums:</p>
<div class="fragment"><div class="line">std::vector&lt;double&gt; my_output(mat-&gt;nrow());</div>
<div class="line"><a class="code hl_struct" href="structtatami__stats_1_1sums_1_1Options.html">tatami_stats::sums::Options</a> sopt;</div>
<div class="line"><a class="code hl_function" href="namespacetatami__stats_1_1sums.html#ae53e59fface3d5ea5cb654598f579af9">tatami_stats::sums::apply</a>(<span class="comment">/* row = */</span> <span class="keyword">true</span>, mat.get(), output.data(), sopt);</div>
<div class="ttc" id="anamespacetatami__stats_1_1sums_html_ae53e59fface3d5ea5cb654598f579af9"><div class="ttname"><a href="namespacetatami__stats_1_1sums.html#ae53e59fface3d5ea5cb654598f579af9">tatami_stats::sums::apply</a></div><div class="ttdeci">void apply(bool row, const tatami::Matrix&lt; Value_, Index_ &gt; &amp;mat, Output_ *output, const Options &amp;sopt)</div><div class="ttdef"><b>Definition</b> sums.hpp:207</div></div>
<div class="ttc" id="astructtatami__stats_1_1sums_1_1Options_html"><div class="ttname"><a href="structtatami__stats_1_1sums_1_1Options.html">tatami_stats::sums::Options</a></div><div class="ttdoc">Summation options.</div><div class="ttdef"><b>Definition</b> sums.hpp:28</div></div>
</div><!-- fragment --><p>Some of the algorithms expose low-level functions for even more fine-grained control. For example, we can manage the loop over the matrix rows ourselves, computing the mean and median for each row:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> ext = mat-&gt;dense_row();</div>
<div class="line">std::vector&lt;double&gt; buffer(ncols);</div>
<div class="line">std::vector&lt;double&gt; mean_output(nrows), med_output(nrows);</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> r = 0; r &lt; nrows; ++r) {</div>
<div class="line">    <span class="keyword">auto</span> ptr = ext-&gt;fetch(r, buffer.data());</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Need to count the number of values in the denominator.</span></div>
<div class="line">    <span class="keyword">auto</span> sum = <a class="code hl_function" href="namespacetatami__stats_1_1sums.html#af95ccf6d0eea5492a7ccd6c1c003df92">tatami_stats::sums::direct</a>(ptr, ncols, <span class="comment">/* skip_nan= */</span> <span class="keyword">true</span>);</div>
<div class="line">    <span class="keywordtype">size_t</span> num_notna = 0;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c = 0; c &lt; ncols; ++c) {</div>
<div class="line">        num_notna += !std::isnan(ptr[c]);</div>
<div class="line">    }</div>
<div class="line">    mean_output[r] = sum / not_na;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Copying values into the buffer as median calculation resorts the values.</span></div>
<div class="line">    <a class="code hl_functionRef" href="https://tatami-inc.github.io/tatami/namespacetatami.html#ab52a806e3f13a68741a9e1f77dccab14">tatami::copy_n</a>(ptr, ncols, buffer.data());</div>
<div class="line">    med_output[r] = <a class="code hl_function" href="namespacetatami__stats_1_1medians.html#ad805e96ccca9615107f7360788f24a44">tatami_stats::medians::direct</a>(ptr, ncols, <span class="comment">/* skip_nan= */</span> <span class="keyword">true</span>);</div>
<div class="line">}</div>
<div class="ttc" id="anamespacetatami__stats_1_1medians_html_ad805e96ccca9615107f7360788f24a44"><div class="ttname"><a href="namespacetatami__stats_1_1medians.html#ad805e96ccca9615107f7360788f24a44">tatami_stats::medians::direct</a></div><div class="ttdeci">Output_ direct(Value_ *ptr, Index_ num, bool skip_nan)</div><div class="ttdef"><b>Definition</b> medians.hpp:82</div></div>
<div class="ttc" id="anamespacetatami__stats_1_1sums_html_af95ccf6d0eea5492a7ccd6c1c003df92"><div class="ttname"><a href="namespacetatami__stats_1_1sums.html#af95ccf6d0eea5492a7ccd6c1c003df92">tatami_stats::sums::direct</a></div><div class="ttdeci">Output_ direct(const Value_ *ptr, Index_ num, bool skip_nan)</div><div class="ttdef"><b>Definition</b> sums.hpp:57</div></div>
<div class="ttc" id="anamespacetatami_html_ab52a806e3f13a68741a9e1f77dccab14"><div class="ttname"><a href="https://tatami-inc.github.io/tatami/namespacetatami.html#ab52a806e3f13a68741a9e1f77dccab14">tatami::copy_n</a></div><div class="ttdeci">Value_ * copy_n(const Value_ *input, Size_ n, Value_ *output)</div></div>
</div><!-- fragment --><p>These low-level functions allow developers to compute multiple statistics with a single pass through the matrix. In contrast, calling <code><a class="el" href="namespacetatami__stats_1_1sums.html#a789933d544ed5e4a6b4f682f03db56e2">tatami_stats::sums::by_row</a></code> and <code><a class="el" href="namespacetatami__stats_1_1medians.html#ab70115fd094f9395a13bd3d18418df51">tatami_stats::medians::by_row</a></code> separately would extract data from the matrix twice, which may be expensive for file-backed matrices.</p>
<h1>Building projects</h1>
<h2>CMake with <code>FetchContent</code></h2>
<p>If you're using CMake, you just need to add something like this to your <code>CMakeLists.txt</code>:</p>
<div class="fragment"><div class="line">include(FetchContent)</div>
<div class="line"> </div>
<div class="line">FetchContent_Declare(</div>
<div class="line">  tatami_stats</div>
<div class="line">  GIT_REPOSITORY https://github.com/tatami-inc/tatami_stats</div>
<div class="line">  GIT_TAG master # or any version of interest </div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">FetchContent_MakeAvailable(tatami_stats)</div>
</div><!-- fragment --><p>Then you can link to <b><a class="el" href="namespacetatami__stats.html" title="Functions to compute statistics from a tatami::Matrix.">tatami_stats</a></b> to make the headers available during compilation:</p>
<div class="fragment"><div class="line"># For executables:</div>
<div class="line">target_link_libraries(myexe tatami_stats)</div>
<div class="line"> </div>
<div class="line"># For libaries</div>
<div class="line">target_link_libraries(mylib INTERFACE tatami_stats)</div>
</div><!-- fragment --><p>By default, this will use <code>FetchContent</code> to fetch all external dependencies. Applications are advised to pin the versions of these dependencies themselves - see <a href="extern/CMakeLists.txt"><code>extern/CMakeLists.txt</code></a> for suggested (minimum) versions. If you want to install them manually, use <code>-DTATAMI_STATS_FETCH_EXTERN=OFF</code>.</p>
<h2>CMake with <code>find_package()</code></h2>
<p>You can install the library by cloning a suitable version of this repository and running the following commands:</p>
<div class="fragment"><div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line">cmake .. -DTATAMI_STATS_TESTS=OFF</div>
<div class="line">cmake --build . --target install</div>
</div><!-- fragment --><p>Then you can use <code>find_package()</code> as usual:</p>
<div class="fragment"><div class="line">find_package(tatami_tatami_stats CONFIG REQUIRED)</div>
<div class="line">target_link_libraries(mylib INTERFACE tatami::tatami_stats)</div>
</div><!-- fragment --><p>Again, this will use <code>FetchContent</code> to retrieve dependencies, see advice above.</p>
<h2>Manual</h2>
<p>If you're not using CMake, the simple approach is to just copy the files the <code>include/</code> subdirectory - either directly or with Git submodules - and include their path during compilation with, e.g., GCC's <code>-I</code>. This also requires the dependencies listed in <a href="extern/CMakeLists.txt"><code>extern/CMakeLists.txt</code></a>. </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
